import { genEvent } from 'jsr:@nostrify/nostrify@^0.46.4/test';
import { assertRejects } from 'jsr:@std/assert@^0.222.1';

import { ErrorRelay } from './ErrorRelay.ts';

Deno.test('ErrorRelay', async () => {
  const store = new ErrorRelay();
  await assertRejects(() => store.event(genEvent()));
  await assertRejects(() => store.query([]));
  await assertRejects(() => store.count([]));
  await assertRejects(() => store.remove([]));
  await assertRejects(() => store.close());

  await assertRejects(async () => {
    for await (const _ of store.req([])) {
      // Do nothing.
    }
  });
});
